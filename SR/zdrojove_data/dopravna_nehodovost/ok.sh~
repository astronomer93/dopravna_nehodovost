shopt -s extglob #zapneme extglob, aby fungovalo vymazanie vsetkych suborov, ktore su mimo match regex

for rok in {2010..2018}
do
	cd $rok

	nameColumn="Week;Nehodovost;"	
	echo $nameColumn >> celkova_nehodovost${rok}.csv

	nameColumn="Week;Zraneni;"	
	echo $nameColumn >> zraneni${rok}.csv

	nameColumn="Week;Usmrteni;"	
	echo $nameColumn >> usmrteni${rok}.csv

	for week in {1..52} 
	do
		
		tyzdenValue=$(pdftotext -raw ${week}.tyzden.${rok}.pdf - | grep 'roka' | head -1 | egrep -o '^[0-9]{1,2}\.')
		weekly="${tyzdenValue}tyzden.${rok}"

		trafficValue=$(pdftotext -raw ${week}.tyzden.${rok}.pdf - | grep -A2 nehody | head -3 | grep "$rok" | egrep -o '[0-9]{1,4}$')
		rowTraffic="${weekly};${trafficValue};"
		echo $rowTraffic >> celkova_nehodovost${rok}.csv

		zraneniValue=$(pdftotext -raw ${week}.tyzden.${rok}.pdf - | grep -A2 zranení | head -3 | grep "$rok" | egrep -o '[0-9]{1,4}$')
		rowZraneni="${weekly};${zraneniValue};"
		echo $rowZraneni >> zraneni${rok}.csv

		if [ $rok -eq 2010 ]; then
			usmrteniValue=$(pdftotext -raw ${week}.tyzden.${rok}.pdf - | grep -A2 Usmrtení | head -3 | grep "$rok" | egrep -o '[0-9]{1,4}$')
				
		else 
			usmrteniValue=$(pdftotext -raw ${week}.tyzden.${rok}.pdf - | grep -A2 Usmrtení | head -3 | grep "$rok" | egrep -o '[0-9]{1,3}\/[0-9]{1,3}\/[0-9]{1,3}\/[0-9]{1,3}$' | egrep -o '[0-9]{1,3}' | awk 'BEGIN {num=0;}{num+=$1;} END {print num}')			
		fi
		rowUsmrteni="${weekly};${usmrteniValue};"
		echo $rowUsmrteni >> usmrteni${rok}.csv
	done
	cd ..
done
